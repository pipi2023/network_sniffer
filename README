source /home/peiying/network_sniffer/sniffer_env/bin/activate

sudo $(which python3) main.py

在Windows用户目录下可修改: C:\Users\<用户名>\.wslconfig
[wsl2]
firewall=false
autoProxy=false
networkingMode=bridged或mirrored
vmSwitch=Default Switch
dhcp=true

在Windows用户目录下可查看代码: \\wsl.localhost\Ubuntu\home\<用户名>

测试ping(ICMP协议): 选择接口eth0:  ping -s 1000 172.23.0.1 -c 1
        分片        : ping -s 3000 172.23.0.1 -c 1
        其中172.23.0.1为Windows主机在WSL2网络中的IP
        注意: 需要关闭windows防火墙

DNS 查询(UDP协议): wsl中执行: sudo tcpdump -i any port 53 -nn -v
        选择接口lo, wsl中另起终端: nslookup www.baidu.com

HTTP 请求(TCP协议): 选择接口eth0: curl -v http://httpbin.org/get

传输文件操作: 
        Netcat测试(filter: port 9999):
        跨主机(选择接口eth0)(wsl2上可以通过: sudo tcpdump -i any port 9999 -vvv -X 验证)
        windows上终端输入:  
                        $listener = [System.Net.Sockets.TcpListener]::new(9999)
                        $listener.Start()
                        $client = $listener.AcceptTcpClient()
        wsl2上终端输入: 
                        echo "Hello Sniffer Test!" > send_file.txt
                        nc -N 172.23.0.1 9999 < send_file.txt
                        其中172.23.0.1为Windows主机在WSL2网络中的IP
        windows上终端输入:
                        $stream = $client.GetStream()
                        $fileStream = [System.IO.File]::Create('received_file.txt')
                        $stream.CopyTo($fileStream)
                        $fileStream.Close()
                        $stream.Close()
                        $client.Close()
                        $listener.Stop() 
        本地回环(选择接口lo)(wsl2上可以通过: sudo tcpdump -i any port 9999 -vvv -X验证)
        wsl2上终端输入: 
                nc -N -l -p 9999 > received_file.txt
        wsl2上另起终端输入:
                echo "Hello Sniffer Test!" > send_file.txt
                nc -N 172.23.1.122 9999 < send_file.txt

        HTTP测试(filter: port 8000):
        跨主机(选择接口eth0):
        wsl2上终端输入: 
                echo 'Test HTTP File!' > HTTPFile_test.txt
                python3 -m http.server 8000 &  # 在WSL内部启动一个Web服务器
        windows上终端输入: wget http://172.23.1.122:8000/HTTPFile_test.txt  -UseBasicParsing -OutFile "HTTPFile_test.txt"
        wsl2上终端输入: pkill -f "http.server 8000" # 关闭服务器
